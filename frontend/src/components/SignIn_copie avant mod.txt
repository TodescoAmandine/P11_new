import React from "react";
import { NavLink } from 'react-router-dom';

const userEmail = document.getElementById("username");
const userPassword = document.getElementById("password");
const form = document.getElementById("form");
const messageError = document.getElementById("error");

async function postUser(email, password) {
  const response = await fetch("http://localhost:3001/api/v1/user/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password }),
  });
  return response.json();
}

function login() {
//  checkIfUserIsLog()
  form.addEventListener("submit", (e) => {
      messageError.textContent = '';
      e.preventDefault();

      const data = {
          email: userEmail.value,
          password: userPassword.value
      }

      if (data.email !== '' && data.password !== '') {
          const chargeUtile = JSON.stringify(data);
          postUser(chargeUtile).then((response) => {
              if (response.token) {
                  const valeurUserToken = JSON.stringify(response)
                  window.localStorage.setItem("userToken", valeurUserToken)
                  location.href = "index.html"
              } else {
                  messageError.textContent = "Utilisateur inconnu";
              }
          })
      } else if (data.email === '' && data.password !== '') {
          messageError.textContent = "Merci de renseigner un email";
      } else if (data.email !== '' && data.password === '') {
          messageError.textContent = "Merci de renseigner un mot de pase";
      } else {
          messageError.textContent = "DonnÃ©es invalides";
      }
  })
}

login();








const SignIn = () => {
  return (
      <main className="main bg-dark">
            <section className="sign-in-content">
        <i className="fa fa-user-circle sign-in-icon"></i>
        <h1>Sign In</h1>
        <form >
          <div className="input-wrapper">
            <label htmlFor="username">Username</label>
            <input type="text" id="username" />
          </div>
          <div className="input-wrapper">
            <label htmlFor="password">Password</label>
            <input type="password" id="password" />
          </div>
          <div className="input-remember">
            <input type="checkbox" id="remember-me" /><label htmlFor="remember-me">Remember me</label>
          </div>
          <NavLink to="/userpage">
          <button  className="sign-in-button" type="submit">Sign In</button>
          </NavLink>
          <p className='error-message' id="error">{errorMessage}</p>
        </form>
      </section>     
      </main>       
    );
};

export default SignIn;